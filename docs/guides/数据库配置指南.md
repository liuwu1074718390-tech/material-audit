# 数据库配置详细指南

## 问题说明
系统提示缺少 `DB_PASSWORD` 环境变量，需要配置数据库连接信息。

## 配置步骤

### 步骤 1: 创建或编辑 `.env` 文件

1. 在项目根目录（`/Users/liuwu/Desktop/材价审计`）下，创建或编辑 `.env` 文件
2. 如果文件不存在，可以复制 `.env.example` 文件：
   ```bash
   cp .env.example .env
   ```

### 步骤 2: 获取腾讯云数据库信息

你需要从腾讯云控制台获取以下信息：

1. **登录腾讯云控制台**
   - 访问：https://console.cloud.tencent.com/
   - 登录你的账号

2. **进入 MySQL 数据库管理**
   - 在控制台搜索"云数据库 MySQL"或"TencentDB"
   - 点击进入你的数据库实例

3. **获取数据库信息**
   - **数据库地址（DB_HOST）**：
     - 在实例详情页找到"内网地址"或"外网地址"
     - 格式类似：`gz-cdb-xxxxx.sql.tencentcdb.com` 或 `10.x.x.x`
   - **端口（DB_PORT）**：
     - 通常是 `3306`，在实例详情页可以查看
   - **用户名（DB_USER）**：
     - 默认是 `root`，或你在创建数据库时设置的用户名
   - **密码（DB_PASSWORD）**：
     - 如果忘记了，可以在"账号管理"中重置密码
   - **数据库名（DB_NAME）**：
     - 需要先创建一个数据库（如果还没有）
     - 建议命名为 `audit_db` 或你喜欢的名称

### 步骤 3: 填写 `.env` 文件

打开 `.env` 文件，按照以下格式填写（**请替换为你的实际信息**）：

```env
# Dify API配置（已有，保持不变）
DIFY_API_KEY=app-CaJJxI5P0DrvwNXAhABB37M6
DIFY_API_URL=http://192.168.1.42/v1/workflows/run
DIFY_WORKFLOW_ID=6495412f-cb02-4702-a1e4-5471a37919c7

# 腾讯云数据库配置（需要填写）
DB_HOST=你的数据库地址
DB_PORT=3306
DB_USER=你的用户名
DB_PASSWORD=你的密码
DB_NAME=你的数据库名
```

**示例**（请替换为你的实际信息）：
```env
DB_HOST=gz-cdb-abc123.sql.tencentcdb.com
DB_PORT=3306
DB_USER=root
DB_PASSWORD=MyPassword123
DB_NAME=audit_db
```

### 步骤 4: 创建数据库和表

1. **创建数据库**（如果还没有）：
   - 在腾讯云控制台的数据库管理页面
   - 点击"创建数据库"
   - 数据库名填写：`audit_db`（或你在 `.env` 中填写的名称）
   - 字符集选择：`utf8mb4`

2. **执行建表 SQL**：
   - 在腾讯云控制台找到"SQL 窗口"或"数据库管理"
   - 选择你创建的数据库
   - 打开 `database/schema.sql` 文件
   - 复制文件中的所有 SQL 语句
   - 在 SQL 窗口中粘贴并执行

### 步骤 5: 重启服务器

配置完成后，需要重启服务器使配置生效：

1. **停止当前服务器**：
   - 在运行 `npm run dev` 的终端窗口
   - 按 `Ctrl + C` 停止服务器

2. **重新启动服务器**：
   ```bash
   npm run dev
   ```

### 步骤 6: 验证配置

1. **访问健康检查页面**：
   - 在浏览器打开：`http://localhost:3000/health`
   - 或点击主页面的"系统健康检查"按钮

2. **检查结果**：
   - 如果所有检查都显示"✓ 正常"，说明配置成功
   - 如果有错误，请根据提示信息调整配置

## 常见问题

### Q1: 忘记数据库密码怎么办？
A: 在腾讯云控制台的"账号管理"中可以重置密码。

### Q2: 不知道数据库地址在哪里？
A: 在腾讯云控制台的数据库实例详情页，找到"连接信息"，里面有内网地址和外网地址。

### Q3: 如何选择内网地址还是外网地址？
A: 
- 如果你的服务器在腾讯云上，使用**内网地址**（更快、免费）
- 如果你的服务器在本地或其他云，使用**外网地址**（需要开启外网访问）

### Q4: 配置后还是连接失败？
A: 检查以下几点：
1. `.env` 文件是否在项目根目录
2. 环境变量名称是否正确（大小写敏感）
3. 数据库地址、端口、用户名、密码是否正确
4. 数据库是否已创建
5. 是否已执行建表 SQL
6. 服务器是否已重启

### Q5: 如何确认 `.env` 文件配置正确？
A: 访问健康检查页面（`/health`），会显示详细的配置信息和错误提示。

## 安全提示

⚠️ **重要**：
- `.env` 文件包含敏感信息，**不要**提交到 Git
- 不要将 `.env` 文件分享给他人
- 如果密码泄露，请立即在腾讯云重置密码

