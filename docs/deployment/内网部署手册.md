# 材价审计系统 - 内网部署手册 (Docker版)

本手册旨在指导部署人员通过 Docker 容器化方案在内网环境快速上线系统。

## 1. 环境准备

请确保目标服务器已安装：
- **Docker**: >= 20.10
- **Docker Compose**: >= 2.0

## 2. 部署流程

### 第一步：同步代码
将项目代码包上传至服务器并解压，进入项目目录（如 `/opt/material_audit`）。

### 第二步：配置环境变量
在项目根目录创建 `.env` 文件，并参考以下配置填写（已根据本地环境预设）：

```bash
# 进入目录
cd /opt/material_audit

# 创建配置文件
vi .env
```

**复制并粘贴以下内容（请根据实际内网环境微调）：**

```ini
# Dify 核心配置 (必填)
DIFY_API_KEY=app-CaJJxI5P0DrvwNXAhABB37M6
DIFY_API_URL=http://192.168.1.42/v1/workflows/run

# 数据库配置 (如有外部 MySQL 请修改)
DB_HOST=127.0.0.1
DB_PORT=3306
DB_USER=root
DB_PASSWORD=mysqlroot
DB_NAME=ruoyi-fastapi

# 应用配置
NODE_ENV=production
PORT=3000
```

### 第三步：初始化数据库
在启动服务前，必须先在 MySQL 数据库中创建表结构。

**执行方式：**
1.  **命令行导入（推荐）**：
    ```bash
    # 替换其中的参数
    mysql -h <数据库地址> -u <用户名> -p <数据库名> < database/schema.sql
    ```
2.  **管理工具执行**：
    手动打开 `database/schema.sql`，复制其内容到 Navicat、DBeaver 或云数据库控制台（如腾讯云 SQL 窗口）中执行。

---

### 第四步：一键启动
执行自动化部署脚本，系统将自动构建镜像并运行容器：

```bash
# 赋予权限
chmod +x scripts/deploy-intranet.sh

# 运行部署
./scripts/deploy-intranet.sh
```

## 3. 验证与访问

1. **访问地址**：`http://服务器IP:3000`
2. **连接状态**：如需查看实时运行日志，可执行：
   ```bash
   docker-compose logs -f app
   ```

## 4. 常见运维操作

- **停止服务**: `docker-compose down`
- **重启服务**: `docker-compose restart app`
- **更新代码后重构**: `docker-compose up -d --build`

---
*注：本项目已剥离腾讯云等外部依赖，完全适配内网独立运行环。*
