# 创建数据库表 - 详细步骤

## 问题说明
数据库连接成功，但缺少数据表。需要执行建表 SQL 语句。

## 方法一：在腾讯云控制台执行（推荐）

### 步骤 1: 登录腾讯云控制台
1. 访问：https://console.cloud.tencent.com/
2. 登录你的账号

### 步骤 2: 进入数据库管理
1. 在控制台搜索"云数据库 MySQL"或"TencentDB"
2. 点击进入你的数据库实例

### 步骤 3: 打开 SQL 窗口
1. 在数据库实例详情页，找到"数据库管理"或"SQL 窗口"
2. 点击"SQL 窗口"或"执行 SQL"
3. 选择你创建的数据库（如 `audit_db`）

### 步骤 4: 复制 SQL 语句
1. 打开项目中的 `database/schema.sql` 文件
2. 复制文件中的所有 SQL 语句（包括所有 CREATE TABLE 语句）

### 步骤 5: 执行 SQL
1. 在 SQL 窗口中粘贴复制的 SQL 语句
2. 点击"执行"或"运行"
3. 等待执行完成

### 步骤 6: 验证表是否创建成功
执行以下 SQL 查询，检查表是否存在：
```sql
SHOW TABLES;
```

应该能看到以下三个表：
- `audit_tasks`
- `audit_materials`
- `audit_results`

## 方法二：使用数据库管理工具执行

如果你使用 Navicat、DBeaver、MySQL Workbench 等工具：

1. **连接到数据库**
   - 使用 `.env` 文件中的数据库信息连接

2. **选择数据库**
   - 选择你创建的数据库（如 `audit_db`）

3. **执行 SQL**
   - 打开 `database/schema.sql` 文件
   - 复制所有 SQL 语句
   - 在工具中执行

## 方法三：使用命令行执行（需要 mysql 客户端）

如果你安装了 mysql 客户端：

```bash
cd /Users/liuwu/Desktop/材价审计

# 读取 .env 文件中的配置
source .env

# 执行 SQL 文件
mysql -h $DB_HOST -P $DB_PORT -u $DB_USER -p$DB_PASSWORD $DB_NAME < database/schema.sql
```

## SQL 文件内容预览

`database/schema.sql` 文件包含以下三个表的创建语句：

1. **audit_tasks** - 审计任务表
   - 存储任务基本信息（任务ID、项目名称、状态、进度等）

2. **audit_materials** - 材料数据表
   - 存储原始材料数据

3. **audit_results** - 审计结果表
   - 存储审计结果数据

## 验证步骤

执行完 SQL 后：

1. **在 SQL 窗口中执行**：
   ```sql
   SHOW TABLES;
   ```
   应该看到三个表

2. **检查表结构**（可选）：
   ```sql
   DESCRIBE audit_tasks;
   DESCRIBE audit_materials;
   DESCRIBE audit_results;
   ```

3. **在系统中验证**：
   - 访问健康检查页面：`http://localhost:3000/health`
   - 或点击主页面的"系统健康检查"按钮
   - 应该看到"表结构检查 ✓ 正常"

## 常见问题

### Q1: 执行 SQL 时报错 "Table already exists"
**原因**：表已经存在

**解决方案**：
- 如果表已存在，可以忽略这个错误
- 或者先删除表再创建（注意：会删除已有数据）：
  ```sql
  DROP TABLE IF EXISTS audit_results;
  DROP TABLE IF EXISTS audit_materials;
  DROP TABLE IF EXISTS audit_tasks;
  ```
  然后重新执行 `schema.sql`

### Q2: 执行 SQL 时报错 "Access denied"
**原因**：数据库用户权限不足

**解决方案**：
- 确保使用的数据库用户有 CREATE TABLE 权限
- 在腾讯云控制台检查用户权限设置

### Q3: 执行 SQL 时报错 "Unknown database"
**原因**：数据库不存在

**解决方案**：
- 先在腾讯云控制台创建数据库
- 数据库名要与 `.env` 文件中的 `DB_NAME` 一致

### Q4: 如何确认 SQL 执行成功？
**检查方法**：
1. 执行 `SHOW TABLES;` 应该看到三个表
2. 访问健康检查页面，表结构检查应该显示"✓ 正常"

## 快速检查命令

执行完 SQL 后，可以在 SQL 窗口中运行：

```sql
-- 查看所有表
SHOW TABLES;

-- 查看表结构
DESCRIBE audit_tasks;
DESCRIBE audit_materials;
DESCRIBE audit_results;

-- 查看表数量（应该返回 3）
SELECT COUNT(*) as table_count 
FROM information_schema.tables 
WHERE table_schema = DATABASE() 
AND table_name IN ('audit_tasks', 'audit_materials', 'audit_results');
```

## 下一步

执行完建表 SQL 后：

1. ✅ 访问健康检查页面验证
2. ✅ 尝试创建审计任务
3. ✅ 如果还有问题，查看健康检查页面的详细错误信息

