# SSH 连接问题排查指南

## 错误信息
```
ssh: connect to host 114.132.45.252 port 22: Connection refused
```

## 问题原因

"Connection refused" 通常表示：
1. **安全组未开放 22 端口**（最常见）
2. 服务器 SSH 服务未启动
3. 防火墙阻止了连接

---

## 解决方案

### 方案一：检查并配置腾讯云安全组（最重要！）

#### 步骤 1: 登录腾讯云控制台

1. 访问：https://console.cloud.tencent.com
2. 登录你的账号

#### 步骤 2: 找到你的服务器

1. 进入 **云服务器 CVM** > **实例**
2. 找到 IP 为 `114.132.45.252` 的服务器
3. 点击服务器名称进入详情页

#### 步骤 3: 配置安全组

1. 在服务器详情页，找到 **安全组** 标签
2. 点击安全组 ID 进入安全组规则页面
3. 点击 **入站规则** > **添加规则**

4. 添加以下规则：

| 类型 | 来源 | 协议端口 | 策略 | 备注 |
|------|------|----------|------|------|
| 自定义 | 0.0.0.0/0 | TCP:22 | 允许 | SSH 连接 |
| 自定义 | 0.0.0.0/0 | TCP:80 | 允许 | HTTP |
| 自定义 | 0.0.0.0/0 | TCP:443 | 允许 | HTTPS |
| 自定义 | 0.0.0.0/0 | TCP:3000 | 允许 | 应用端口 |

**或者更安全的方式**（只允许你的 IP）：
- 来源填写你的公网 IP（可以在 https://www.ip138.com 查看）
- 例如：`123.45.67.89/32`

5. 点击 **完成**

#### 步骤 4: 等待生效

安全组规则通常立即生效，等待 1-2 分钟后重试连接。

---

### 方案二：使用腾讯云控制台登录（临时方案）

如果安全组配置需要时间，可以先通过控制台登录：

1. 在服务器详情页，点击 **登录**
2. 使用 **标准登录方式** 或 **密钥登录**
3. 输入 root 密码登录

登录后可以：
- 检查 SSH 服务状态
- 配置安全组
- 开始部署

---

### 方案三：检查服务器 SSH 服务（如果已能通过控制台登录）

如果可以通过控制台登录，在服务器上执行：

```bash
# 检查 SSH 服务状态
systemctl status sshd
# 或
systemctl status ssh

# 如果服务未运行，启动它
systemctl start sshd
systemctl enable sshd  # 设置开机自启

# 检查防火墙
ufw status  # Ubuntu/Debian
# 或
firewall-cmd --list-all  # CentOS

# 如果防火墙开启，开放 22 端口
ufw allow 22/tcp  # Ubuntu/Debian
# 或
firewall-cmd --permanent --add-port=22/tcp  # CentOS
firewall-cmd --reload
```

---

## 验证连接

配置完安全组后，在本地终端重试：

```bash
ssh root@114.132.45.252
```

如果还是连接不上，可以：

1. **检查端口是否开放**（在本地执行）：
```bash
# Mac/Linux
nc -zv 114.132.45.252 22

# 或使用 telnet
telnet 114.132.45.252 22
```

2. **尝试其他端口**（如果服务器 SSH 配置了非 22 端口）：
```bash
ssh -p 2222 root@114.132.45.252
```

---

## 常见问题

### Q: 安全组配置后还是连不上？
A: 
- 等待 1-2 分钟让规则生效
- 检查规则是否真的添加成功
- 确认服务器 IP 是否正确

### Q: 如何查看我的公网 IP？
A: 访问 https://www.ip138.com 或执行：
```bash
curl ifconfig.me
```

### Q: 忘记 root 密码怎么办？
A: 在腾讯云控制台：
1. 服务器详情页 > **更多** > **密码/密钥** > **重置密码**
2. 按照提示重置密码

---

## 下一步

连接成功后，继续执行部署脚本：

```bash
# 在服务器上执行
cd /tmp
# 下载部署脚本或上传代码后执行
bash /path/to/deploy-tencent.sh
```

